<!DOCTYPE html>
<html>
<head>
  <title>Resilience Terminal</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1 class="glow">RESILIENCE TERMINAL</h1>
<a href="/logout" style="color:#ff4d4d;">Disconnect</a>
<input type="file" id="fileInput" />
<button onclick="uploadImage()">Upload Image</button>

<div class="container">
  <ul id="messages"></ul>
  <input id="input" autocomplete="off" placeholder="Type message..." />
  <button onclick="send()">Transmit</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const input = document.getElementById("input");
const messages = document.getElementById("messages");

function send() {
  if (input.value !== "") {
    socket.emit("chat message", input.value);
    input.value = "";
  }
}

// ðŸ”¥ ADD THIS FUNCTION
async function uploadImage() {
  const fileInput = document.getElementById("fileInput");
  const file = fileInput.files[0];

  if (!file) return alert("Select a file");

  const formData = new FormData();
  formData.append("image", file);

  const res = await fetch("/upload", {
    method: "POST",
    body: formData
  });

  const data = await res.json();

  socket.emit("chat message", "[IMAGE]" + data.imageUrl);
}

// Listen for messages
socket.on("chat message", (msg) => {
  const li = document.createElement("li");

  if (msg.text.startsWith("[IMAGE]")) {
    const img = document.createElement("img");
    img.src = msg.text.replace("[IMAGE]", "");
    img.style.maxWidth = "150px";

    li.textContent = msg.user + " >> ";
    li.appendChild(img);
  } else {
    li.textContent = msg.user + " >> " + msg.text;
  }

  messages.appendChild(li);
});
</script>



</body>
</html>

